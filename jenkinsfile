pipeline
{
    agent any
    stages
    {
        stage("Build code")
        {
            steps
            {
                sh """
                mvn install
                ls -lrt target/
                """
            }
        }

        stage("run unit test")
        {
            steps
            {
                sh"mvn test"
            }
        }
         stage("code analysis")
        {
        steps{

            withSonarQubeEnv('sonar-env')
              {
                sh 'mvn clean package sonar:sonar'
              }
            }
        
        }
        stage("Quality Gate") {
            steps 
            {
              timeout(time: 5, unit: 'MINUTES') {
                waitForQualityGate abortPipeline: true
              }
            }
          }
    }
}