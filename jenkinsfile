pipeline
{
    agent any
    environment 
    {
        def scannerHome = tool 'sonar'
    }   
    stages
    {
        stage("Build code")
        {
            steps
            {
                sh """
                mvn install
                ls -lrt target/
                """
            }
        }

        stage("run unit test")
        {
            steps
            {
                sh"mvn test"
            }
        }
         stage("code analysis")
        {
            steps 
            {
                withSonarQubeEnv('My SonarQube Server')
                 {
                    sh 'mvn clean package sonar:sonar'
                 }
            }
        
        }
        stage("Quality Gate")
         {
            steps 
            {
              timeout(time: 5, unit: 'MINUTES') 
              {
                waitForQualityGate abortPipeline: true
              }
            }
         }
    }
}