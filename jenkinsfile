pipeline
{
    agent any
    // environment 
    // {
    //     def scannerHome = tool 'sonar4.8'
    // }   
    stages
    {
        stage("Build code")
        {
            steps
            {
                sh """
                mvn install
                ls -lrt target/
                """
            }
        }

        stage("run unit test")
        {
            steps
            {
                sh"mvn test"
            }
        }
         stage("code analysis")
        {
            steps 
            {
                withSonarQubeEnv('sonar')
                 {
                    sh "${scannerHome}/bin/sonar-scanner -Dsonar.projectKey=project-sonar -Dsonar.projectName=project-sonar -Dsonar.sources=. -Dsonar.java.binaries=target/classes -Dsonar.sourceEncoding=UTF-8"
                 }
            }
        
        }
        stage("Quality Gate")
         {
            steps 
            {
              timeout(time: 5, unit: 'MINUTES') 
              {
                waitForQualityGate abortPipeline: true
              }
            }
         }
    }
}